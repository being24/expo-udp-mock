# Expo UDP Mock System

M5StackセンサーデータシミュレーションとリアルタイムモニタリングのためのUDP通信システムです。GM6020モーター制御とIMUセンサーデータをシミュレーションし、GUIを通じてリアルタイムで可視化し、双方向UDP通信で制御コマンドを送信できます。

## 🚀 主要機能

### 📊 センサーデータシミュレーション

- **GM6020モーターデータ**: 角度、速度(RPM)、電流、温度、トルク
- **IMUセンサーデータ**: 加速度計(m/s²)、ジャイロスコープ(deg/s)
- **制御データ**: 目標RPM、現在RPM、出力電流、エラー
- **Arduino互換**: 実際のM5Stack Arduinoコードと同一のデータ形式

### 📈 リアルタイムGUIモニタリング

- **デュアルウィンドウ構造**: グラフウィンドウ + データ値ウィンドウ
- **リアルタイムプロット**: 加速度、ジャイロ、モーター角度/速度グラフ
- **設定可能な履歴**: 最大200ポイントのデータ履歴
- **VSync対応**: スムーズな画面更新
- **日本語フォント対応**: Windows日本語環境

### 🔄 双方向UDP通信

- **センサーデータ受信**: ポート8888でセンサーデータ受信
- **制御コマンド送信**: 192.168.1.117:8887へ制御コマンド送信
- **自動/手動モード**: ボタンベースのモード切り替え
- **サイン波モード**: 3秒周期、振幅調整可能な自動テスト

### ⚙️ 単位変換システム

- **RPM ↔ rad/s変換**: 内部RPM処理、外部rad/s送信
- **変換係数**: 1 RPM = π/30 rad/s ≈ 0.10472 rad/s

## 🏗️ プロジェクト構造

```
expo-udp-mock/
├── src/
│   ├── gui.py          # メインGUIアプリケーション
│   ├── sender.py       # M5Stackセンサーデータシミュレーター
│   ├── reciever.py     # Unity/PCデータ受信機
│   └── config.py       # 設定管理 (開発中)
├── pyproject.toml      # プロジェクト設定
├── uv.lock            # 依存関係ロックファイル
├── README.md          # このファイル
└── linkup.sh          # ビルドスクリプト
```

## 🛠️ インストールと実行

### 要件

- Python 3.11+
- Windows (日本語フォント対応用)

### 依存関係インストール

```bash
# uv使用 (推奨)
uv pip install dearpygui>=2.1.0

# またはpip使用
pip install dearpygui>=2.1.0
```

### 実行方法

#### 1. GUIモニタリング開始

```bash
cd src
python gui.py
```

#### 2. センサーデータシミュレーター開始 (オプション)

```bash
cd src
python sender.py
```

#### 3. データ受信機開始 (オプション)

```bash
cd src
python reciever.py
```

## 📋 使用法

### GUIインターフェース

#### メインウィンドウ (グラフ)

- **加速度グラフ**: X, Y, Z軸加速度リアルタイムプロット
- **ジャイログラフ**: X, Y, Z軸角速度 + Raw Z軸プロット
- **モーター角度グラフ**: モーター角度変化
- **モーター速度グラフ**: モーター速度(RPM) + コマンド速度比較

#### データウィンドウ (右側)

- **リアルタイム数値**: すべてのセンサー値の数値表示
- **制御パネル**: 手動/自動モード設定
- **コマンド送信**: UDPで制御コマンド送信

### 制御モード

#### 手動モード (Manual Mode)

1. **Manual Speed**: -1000 ~ 1000 RPM設定
2. **isRunning**: モーター動作状態チェックボックス
3. **isTake**: 追加制御フラグ
4. **"Send Manual Command"**: 手動コマンド送信

#### 自動モード (Auto Mode)

1. **Enable Sine Mode**: サイン波モード有効化
2. **Sine Amplitude**: 0~1000 RPM振幅設定
3. **"Activate Auto Send Mode"**: 自動モード有効化
4. **自動送信**: UDP受信時毎に自動でコマンド送信

### サイン波モード特徴

- **周期**: 3秒 (設定可能)
- **波形**: `amplitude × sin(2π × frequency × time)`
- **範囲**: -amplitude ~ +amplitude RPM
- **リアルタイム表示**: 現在速度値表示

## 🔧 ネットワーク設定

### 基本ポート構成

```
受信ポート: 8888 (センサーデータ受信)
送信先: target_ip:8887 (制御コマンド送信)
タイムアウト: 1.0秒
```

### データ形式

#### 受信データ (センサー)

```json
{
  "motor": {
    "angle": 123.456,      // 度 (°)
    "speed": 150,          // RPM
    "current": 1.234,      // アンペア (A)
    "temp": 45,            // 摂氏 (°C)
    "torque": 1024         // 生値
  },
  "control": {
    "target_rpm": 100,     // 目標RPM
    "current_rpm": 98.5,   // 現在RPM
    "output_current": 1.2, // 出力電流 (A)
    "error": 1.5           // エラー
  },
  "accel": {
    "x": 0.123, "y": 0.456, "z": 9.789  // m/s²
  },
  "gyro": {
    "x": 1.2, "y": 3.4, "z": 5.6,      // deg/s
    "raw_z": 45.6                        // 生Z軸値
  },
  "timestamp": 12345,      // ミリ秒
  "counter": 678           // パケットカウンター
}
```

#### 送信データ (制御)

```json
{
  "speed": 15.708,         // rad/s (RPMから変換)
  "isRunning": true,       // 動作状態
  "isTake": false          // 追加制御フラグ
}
```
